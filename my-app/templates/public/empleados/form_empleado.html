{% extends 'public/base_cpanel.html' %}
<!--Cambiando el title-->
{% block title %}Crud con Python  | Registrar Empleado{% endblock %}
<!---->
{% block customCSS %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename ='assets/css/file.css') }}" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
{% endblock %}



<!--Inicio del block-->
{% block body %}
<div class="card" style="border-radius: 0px !important">
  <div class="row justify-content-center mb-2">
    <div class="col-md-12">
      <h3 class="text-center mt-5 mb-3">REGISTRAR NUEVO EMPLEADO</h3>
      <hr />
    </div>
  </div>

  <div class="row justify-content-center mb-2">
    <div class="col-md-10">
      <form
        class="form-horizontal mx-auto"
        method="POST"
        action="/form-registrar-empleado"
        autocomplete="off"
        enctype="multipart/form-data">
        <div class="card-body">

          <div id="accordion">
           <!-- DATOS PERSONALES -->
            <div class="card">
              <div class="card-header" id="headingOne">
                <h5 class="mb-0">
                  <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    Datos Personales
                  </button>
                </h5>
              </div>
          
              <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-4">
                      <label for="Nombre_Completo" class="form-label">
                        Nombre completo
                      </label>
                      <input
                        type="text"
                        name="Nombre_Completo"
                        class="form-control"
                        required />
                    </div>
                    <div class="col-md-4">
                      <label for="RUT" class="form-label">
                        Rut
                      </label>
                      <input
                        class="form-control"
                        type="text"
                       
                        name="RUT"
                        required />
                    </div>
                    <div class="col-md-4">
                      <label for="Sexo" class="form-label">
                        Sexo del empleado
                      </label>
                      <select
                        class="form-select"
                        name="Sexo"
                        aria-label="Default select example">
                        <option selected>Seleccione</option>
                        <option value="1">Masculino</option>
                        <option value="2">Femenino</option>
                      </select>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-8">
                      <label for="direccion" class="form-label">
                        Direcci贸n
                      </label>
                      <input
                        type="text"
                        id="Direccion"
                        name="Direccion"
                        class="form-control"
                        required />
                    </div>
                    <div class="col-md-4">
                      <label for="telefono" class="form-label">
                        Tel茅fono 
                      </label>
                      <input
                        class="form-control"
                        type="text"
                        id="Telefono"
                        name="Telefono"
                        required />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-4">
                      <label for="email_user" class="form-label">
                        Correo electr贸nico
                      </label>
                      <input
                        type="email"
                        name="email_user"
                        class="form-control"
                        required />
                    </div>
                    <div class="col-md-4">
                      <label for="region" class="form-label">
                        Regi贸n
                      </label>
                      <select id="Id_Region" name="Id_Region" class="form-select" 
                        onchange="filtrarComunas(this.value)">
                        <option selected>Seleccione</option>
                        {% for option in regiones %}
                            <option value="{{ option.Id_Region}}">{{ option.Nombre }}</option>
                        {% endfor %}
                        </select>
                    </div>
                    <!-- <div class="col-md-4">
                      <label for="comuna" class="form-label">
                        Comuna
                      </label>
                      <select id="Id_Comuna" name="comuna" class="form-select">
                        <option value="">Seleccione</option>
                        
                        </select>
                    </div> -->
                  </div>
                </div>
              </div>
            </div>
             <!-- DATOS LABORALES -->
            <div class="card">
              <div class="card-header" id="headingTwo">
                <h5 class="mb-0">
                  <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    Datos laborales
                  </button>
                </h5>
              </div>
              <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                <div class="card-body">
                  <div class="row mt-2">
                    <div class="col-md-4">
                      <label for="area" class="form-label">
                        rea
                      </label>
                      <input
                        type="text"
                 
                        name="Area_Departamento"
                        class="form-control"
                        required />
                    </div>
                    <div class="col-md-4">
                      <label for="Sueldo" class="form-label">
                        Salario 
                      </label>
                      <input
                        class="form-control"
                        type="text"
                        name="Sueldo"
                        id="Sueldo"
                        required />
                    </div>
                    <div class="col-md-4">
                      <label for="cargo" class="form-label">
                        Cargo
                      </label>
                      <input
                        class="form-control"
                        type="text"
                        id="Cargo"
                        name="Cargo"
                        required />
                    </div>
                  </div>
                  <div class="row mt-2">                  
                    <div class="col-md-4">
                      <label for="SeguroSalud" class="form-label">
                        Seguro de Salud
                      </label>
                      <select id="Id_Seguro_Salud" name="Id_Seguro_Salud" class="form-select">
                        <option selected>Seleccione</option>
                        {% for option in seguroSalud %}
                            <option value="{{ option.Id_Seguro_Salud}}">{{ option.Nombre }}</option>
                        {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                      <label for="Id_Rol" class="form-label">
                        Rol
                      </label>
                      <select id="Id_Rol" name="Id_Rol" class="form-select">
                        <option selected>Seleccione</option>
                        {% for option in roles %}
                            <option value="{{ option.Id_Rol}}">{{ option.Rol }}</option>
                        {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                      <label for="FechaIngreso" class="form-label">
                        Fecha Ingreso
                      </label>
                      <input
                        class="form-control"
                        type="text"
                        id="Fecha_Ingreso"
                        name="Fecha_Ingreso"
                        required />
                    </div>
                  </div>
                </div>
              </div>
            </div>
              <!-- CONTACTO EMERGENCIA -->
            <div class="card">
              <div class="card-header" id="headingThree">
                <h5 class="mb-0">
                  <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    Contacto de emergencia
                  </button>
                </h5>
              </div>
              <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                <div class="card-body">
                  <div class="row mt-2">
                    <div class="col-md-4">
                      <label for="nombreContacto" class="form-label">
                        Nombre del contacto
                      </label>
                      <input
                        class="form-control"
                        type="text"
                        id="Nombre_Contacto"
                        name="Nombre_Contacto"
                        required />
                    </div>
                    <div class="col-md-4">
                      <label for="relacionEmpleado" class="form-label">
                        Relaci贸n con el empleado
                      </label>
                      <input
                        class="form-control"
                        type="text"
                        id="Relacion"
                        name="Relacion"
                        required />
                    </div>
                    <div class="col-md-4">
                      <label for="telefonoContacto" class="form-label">
                        Tel茅fono Contacto
                      </label>
                      <input
                        class="form-control"
                        type="text"
                        id="Telefono_Contacto"
                        name="Telefono_Contacto"
                        required />
                    </div>
                  </div>
                </div>
              </div>
            </div>

              <!-- CARGAS FAMILIARES -->
              <div class="card">
                <div class="card-header" id="headingFour">
                  <h5 class="mb-0">
                    <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                      Cargas familiares
                    </button>
                  </h5>
                </div>
                <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">
                  <div class="card-body">
                    <div class="row mt-2">
                      <div class="col-md-6">
                        <label for="nombreCarga" class="form-label">
                          Nombre 
                        </label>
                        <input
                          class="form-control"
                          type="text"
                          id="Nombre_Carga"
                          name="Nombre_Carga"
                          required />
                      </div>                   
                      <div class="col-md-6">
                        <label for="RUT_Carga" class="form-label">
                          Rut
                        </label>
                        <input
                          class="form-control"
                          type="text"
                          id="RUT_Carga"
                          name="RUT_Carga"
                          required />
                      </div>
                    </div>
                    <div class="row mt-2">
                      <div class="col-md-6">
                        <label for="parentesco" class="form-label">
                          Parentesco
                        </label>
                        <input
                          class="form-control"
                          type="text"
                          
                          name="Parentesco"
                          required />
                      </div>
                      <div class="col-md-6">
                        <label for="sexo" class="form-label">
                          Sexo 
                        </label>
                        <select
                          class="form-select"
                     
                          name="SexoParentesco"
                          aria-label="Default select example">
                          <option selected>Seleccione</option>
                          <option value="1">Masculino</option>
                          <option value="2">Femenino</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
          </div>

          <div class="mb-3 mt-4 text-center">
            <button type="submit" class="btn rounded-pill btn-primary">
              Guardar registro ahora
              <i class="bi bi-arrow-clockwise"></i>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %} {% block customJS %}
<script src="{{ url_for('static', filename ='assets/customJS/file.js') }}"></script>
<script>
 
 const filtrarComunas = async (Id_Region) => {
    const csrfTokenValue = document.querySelector(
      "[name=csrfmiddlewaretoken]"
    ).value;
    const headers = {
      "X-CSRFToken": csrfTokenValue,
    };
  
    let url = "/filtrar-municipios/";
    try {
      const response = await axios.post(url, { Id_Region }, { headers });
  
      const { data, status } = response;
      console.log(data.data);
  
      if (status == 200) {
        let selectMunicipio = document.querySelector("#Id_Comuna");
        selectMunicipio.innerHTML = "";
  
        // Crea una opci贸n por defecto
        const defaultOption = document.createElement("option");
        defaultOption.value = "";
        defaultOption.text = "Seleccione";
        selectMunicipio.appendChild(defaultOption);
  
        // Itera sobre la data para agregar los municipios al select
        data.data.forEach((item) => {
          const option = document.createElement("option");
          option.value = item.Id_Comuna;
          option.text = item.Nombre;
          selectMunicipio.appendChild(option);
        });
      } else {
        console.log("No hay Municipios disponibles");
      }
    } catch (error) {
      console.log("Error en la petici贸n", error);
    }
  };
  
</script>
{% endblock %}
